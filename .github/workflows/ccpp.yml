name: CI

on:
  push:
    branches:
      - '*'
  pull_request:
    types: [opened, reopened, synchronize, labeled]
    branches: [master]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        container:
        - {os: 'fedora', ver: '40'}
        - {os: 'ubuntu', ver: 'noble'}
        - {os: 'ubuntu', ver: 'jammy'}
        - {os: 'debian', ver: 'bookworm'}

    container:
      image: ${{ matrix.container.os }}:${{ matrix.container.ver }}

    steps:
    - name: Install git
      run: |
        apt-get -qy install git || true
        dnf install -y git || true

    - uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        ./toolbox/pkgs/${{ matrix.container.os }}-${{ matrix.container.ver }}.sh

    - name: Build
      run: |
        make common
